// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  email     String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Staff {
  id           String        @id @default(cuid())
  name         String
  email        String?
  phone        String?
  title        String?
  order        Int           @default(0)
  workSchedule WorkSchedule[]
  appointments Appointment[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model WorkSchedule {
  id          String    @id @default(cuid())
  staffId     String
  staff       Staff     @relation(fields: [staffId], references: [id], onDelete: Cascade)
  dayOfWeek   DayOfWeek
  isWorking   Boolean   @default(true)
  startTime   String?   // Format: "09:00"
  endTime     String?   // Format: "17:00"
  interval    Int?      @default(30) // Minutes
  breakStart  String?   // Format: "12:00"
  breakEnd    String?   // Format: "13:00"
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([staffId, dayOfWeek])
}

model Appointment {
  id          String            @id @default(cuid())
  code        String            @unique // 6-digit code
  customerName String
  customerPhone String
  staffId     String
  staff       Staff             @relation(fields: [staffId], references: [id], onDelete: Cascade)
  date        DateTime
  time        String            // Format: "09:00"
  status      AppointmentStatus @default(PENDING)
  notes       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([customerPhone])
  @@index([date, time, staffId])
}

model SliderImage {
  id          String   @id @default(cuid())
  name        String
  url         String
  description String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SiteSettings {
  id          String   @id @default(cuid())
  companyName String   @default("Sanal Randevu")
  companyLogo String?
  businessNumber String?
  description String?
  themeColor  String   @default("#3B82F6")
  themeFont   String   @default("inter")
  darkMode    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AppointmentView {
  id            String   @id @default(cuid())
  appointmentId String?
  userAgent     String?
  ipAddress     String?
  location      String?
  viewedAt      DateTime @default(now())
}

enum Role {
  USER
  ADMIN
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}
