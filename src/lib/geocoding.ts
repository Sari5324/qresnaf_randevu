// Türkiye'nin 81 ili ve koordinatları
export const turkishCities = [
  { name: 'Adana', lat: 37.0000, lng: 35.3213 },
  { name: 'Adıyaman', lat: 37.7648, lng: 38.2786 },
  { name: 'Afyonkarahisar', lat: 38.7507, lng: 30.5567 },
  { name: 'Ağrı', lat: 39.7191, lng: 43.0503 },
  { name: 'Amasya', lat: 40.6499, lng: 35.8353 },
  { name: 'Ankara', lat: 39.9334, lng: 32.8597 },
  { name: 'Antalya', lat: 36.8841, lng: 30.7056 },
  { name: 'Artvin', lat: 41.1828, lng: 41.8183 },
  { name: 'Aydın', lat: 37.8560, lng: 27.8416 },
  { name: 'Balıkesir', lat: 39.6484, lng: 27.8826 },
  { name: 'Bilecik', lat: 40.1553, lng: 29.9833 },
  { name: 'Bingöl', lat: 38.8859, lng: 40.4986 },
  { name: 'Bitlis', lat: 38.4127, lng: 42.1232 },
  { name: 'Bolu', lat: 40.5760, lng: 31.5788 },
  { name: 'Burdur', lat: 37.4613, lng: 30.0665 },
  { name: 'Bursa', lat: 40.2669, lng: 29.0634 },
  { name: 'Çanakkale', lat: 40.1553, lng: 26.4142 },
  { name: 'Çankırı', lat: 40.5988, lng: 33.6134 },
  { name: 'Çorum', lat: 40.5506, lng: 34.9556 },
  { name: 'Denizli', lat: 37.7765, lng: 29.0864 },
  { name: 'Diyarbakır', lat: 37.9144, lng: 40.2306 },
  { name: 'Edirne', lat: 41.6818, lng: 26.5623 },
  { name: 'Elazığ', lat: 38.6810, lng: 39.2264 },
  { name: 'Erzincan', lat: 39.7500, lng: 39.5000 },
  { name: 'Erzurum', lat: 39.9000, lng: 41.2700 },
  { name: 'Eskişehir', lat: 39.7767, lng: 30.5206 },
  { name: 'Gaziantep', lat: 37.0662, lng: 37.3833 },
  { name: 'Giresun', lat: 40.9128, lng: 38.3895 },
  { name: 'Gümüşhane', lat: 40.4386, lng: 39.5086 },
  { name: 'Hakkari', lat: 37.5744, lng: 43.7408 },
  { name: 'Hatay', lat: 36.4018, lng: 36.3498 },
  { name: 'Isparta', lat: 37.7648, lng: 30.5566 },
  { name: 'Mersin', lat: 36.8000, lng: 34.6333 },
  { name: 'İstanbul', lat: 41.0082, lng: 28.9784 },
  { name: 'İzmir', lat: 38.4192, lng: 27.1287 },
  { name: 'Kars', lat: 40.6013, lng: 43.0975 },
  { name: 'Kastamonu', lat: 41.3887, lng: 33.7827 },
  { name: 'Kayseri', lat: 38.7312, lng: 35.4787 },
  { name: 'Kırklareli', lat: 41.7333, lng: 27.2167 },
  { name: 'Kırşehir', lat: 39.1425, lng: 34.1709 },
  { name: 'Kocaeli', lat: 40.8533, lng: 29.8815 },
  { name: 'Konya', lat: 37.8667, lng: 32.4833 },
  { name: 'Kütahya', lat: 39.4167, lng: 29.9833 },
  { name: 'Malatya', lat: 38.3552, lng: 38.3095 },
  { name: 'Manisa', lat: 38.6191, lng: 27.4289 },
  { name: 'Kahramanmaraş', lat: 37.5858, lng: 36.9371 },
  { name: 'Mardin', lat: 37.3212, lng: 40.7245 },
  { name: 'Muğla', lat: 37.2153, lng: 28.3636 },
  { name: 'Muş', lat: 38.9462, lng: 41.7539 },
  { name: 'Nevşehir', lat: 38.6939, lng: 34.6857 },
  { name: 'Niğde', lat: 37.9667, lng: 34.6833 },
  { name: 'Ordu', lat: 40.9839, lng: 37.8764 },
  { name: 'Rize', lat: 41.0201, lng: 40.5234 },
  { name: 'Sakarya', lat: 40.6940, lng: 30.4358 },
  { name: 'Samsun', lat: 41.2928, lng: 36.3313 },
  { name: 'Siirt', lat: 37.9333, lng: 41.9500 },
  { name: 'Sinop', lat: 42.0231, lng: 35.1531 },
  { name: 'Sivas', lat: 39.7477, lng: 37.0179 },
  { name: 'Tekirdağ', lat: 40.9833, lng: 27.5167 },
  { name: 'Tokat', lat: 40.3167, lng: 36.5500 },
  { name: 'Trabzon', lat: 41.0015, lng: 39.7178 },
  { name: 'Tunceli', lat: 39.3074, lng: 39.4388 },
  { name: 'Şanlıurfa', lat: 37.1591, lng: 38.7969 },
  { name: 'Uşak', lat: 38.6823, lng: 29.4082 },
  { name: 'Van', lat: 38.4891, lng: 43.4089 },
  { name: 'Yozgat', lat: 39.8181, lng: 34.8147 },
  { name: 'Zonguldak', lat: 41.4564, lng: 31.7987 },
  { name: 'Aksaray', lat: 38.3687, lng: 34.0370 },
  { name: 'Bayburt', lat: 40.2552, lng: 40.2249 },
  { name: 'Karaman', lat: 37.1759, lng: 33.2287 },
  { name: 'Kırıkkale', lat: 39.8468, lng: 33.5153 },
  { name: 'Batman', lat: 37.8812, lng: 41.1351 },
  { name: 'Şırnak', lat: 37.4187, lng: 42.4918 },
  { name: 'Bartın', lat: 41.5811, lng: 32.4610 },
  { name: 'Ardahan', lat: 41.1105, lng: 42.7022 },
  { name: 'Iğdır', lat: 39.8880, lng: 44.0048 },
  { name: 'Yalova', lat: 40.6500, lng: 29.2667 },
  { name: 'Karabük', lat: 41.2061, lng: 32.6204 },
  { name: 'Kilis', lat: 36.7184, lng: 37.1212 },
  { name: 'Osmaniye', lat: 37.2130, lng: 36.1763 },
  { name: 'Düzce', lat: 40.8438, lng: 31.1565 }
]

/**
 * Verilen koordinatlara en yakın Türk şehrini bulur
 * @param lat - Enlem
 * @param lng - Boylam
 * @returns En yakın şehir adı
 */
export function getClosestTurkishCity(lat: number, lng: number): string {
  let closestCity = turkishCities[0]
  let minDistance = calculateDistance(lat, lng, closestCity.lat, closestCity.lng)

  for (const city of turkishCities) {
    const distance = calculateDistance(lat, lng, city.lat, city.lng)
    if (distance < minDistance) {
      minDistance = distance
      closestCity = city
    }
  }

  return closestCity.name
}

/**
 * İki koordinat noktası arasındaki mesafeyi hesaplar (Haversine formülü)
 * @param lat1 - İlk noktanın enlemi
 * @param lng1 - İlk noktanın boylamı
 * @param lat2 - İkinci noktanın enlemi
 * @param lng2 - İkinci noktanın boylamı
 * @returns Kilometre cinsinden mesafe
 */
function calculateDistance(lat1: number, lng1: number, lat2: number, lng2: number): number {
  const R = 6371 // Dünya'nın yarıçapı (km)
  const dLat = toRadians(lat2 - lat1)
  const dLng = toRadians(lng2 - lng1)
  
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2)
  
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))
  return R * c
}

/**
 * Derece cinsinden açıyı radyana çevirir
 * @param degrees - Derece değeri
 * @returns Radian değeri
 */
function toRadians(degrees: number): number {
  return degrees * (Math.PI / 180)
}

/**
 * Konum string'ini formatlar - koordinat ise şehir adına çevirir
 * @param location - Konum string'i (koordinat veya şehir adı)
 * @returns Formatlanmış konum ("Şehir, Türkiye" formatında)
 */
export function getDisplayLocation(location: string): string {
  // Koordinat formatı kontrolü (lat, lng)
  const coordinatePattern = /^-?\d+\.?\d*\s*,\s*-?\d+\.?\d*$/
  
  if (coordinatePattern.test(location.trim())) {
    try {
      const [latStr, lngStr] = location.split(',').map(s => s.trim())
      const lat = parseFloat(latStr)
      const lng = parseFloat(lngStr)
      
      if (!isNaN(lat) && !isNaN(lng)) {
        const cityName = getClosestTurkishCity(lat, lng)
        return `${cityName}, Türkiye`
      }
    } catch (error) {
      console.error('Koordinat ayrıştırma hatası:', error)
    }
  }
  
  // Zaten şehir adı formatında ise olduğu gibi döndür
  if (location.includes('Türkiye')) {
    return location
  }
  
  // Şehir adı ise "Şehir, Türkiye" formatına çevir
  return `${location}, Türkiye`
}
